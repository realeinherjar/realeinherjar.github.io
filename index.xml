<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:content="http://purl.org/rss/1.0/modules/content/">
  <channel>
    <title>Einherjar</title>
    <link>https://realeinherjar.github.io/</link>
    <description>Recent content on Einherjar</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>en-us</language>
    <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/)</copyright>
    <lastBuildDate>Sun, 01 Oct 2023 16:08:15 -0300</lastBuildDate><atom:link href="https://realeinherjar.github.io/index.xml" rel="self" type="application/rss+xml" />
    <item>
      <title>What the hell is an Elliptic Curve?</title>
      <link>https://realeinherjar.github.io/2023-10-08-elliptic_curves/</link>
      <pubDate>Sun, 01 Oct 2023 16:08:15 -0300</pubDate>
      
      <guid>https://realeinherjar.github.io/2023-10-08-elliptic_curves/</guid>
      <description>Warning: This post has KaTeX enabled, so if you want to view the rendered math formulas, you&amp;rsquo;ll have to unfortunately enable JavaScript.
Note: All elliptic curve images are made using $\LaTeX$ and TikZ. The source code is freely available at GitHub.
What the hell is an Elliptic Curve? In this post, I&amp;rsquo;ll try to explain what an elliptic curve is, and why it&amp;rsquo;s so important in cryptography. If you ever used an end-to-end encrypted messaging app, or hold Bitcoin (or any other shitcoin, though I don&amp;rsquo;t recommend it), you&amp;rsquo;ve probably heard of elliptic curves.</description>
      <content:encoded><![CDATA[<blockquote>
<p>Warning: This post has <a href="https://katex.org/">KaTeX</a> enabled,
so if you want to view the rendered math formulas,
you&rsquo;ll have to unfortunately enable JavaScript.</p>
<p>Note: All elliptic curve images are made using $\LaTeX$ and TikZ.
The source code is freely available at <a href="https://gist.github.com/realeinherjar/84061e78c85e08476f373e77c5a652ac">GitHub</a>.</p>
</blockquote>
<p>What the hell is an Elliptic Curve?
In this post, I&rsquo;ll try to explain what an elliptic curve is,
and why it&rsquo;s so important in cryptography.
If you ever used an end-to-end encrypted messaging app,
or hold Bitcoin (or any other shitcoin, though I don&rsquo;t recommend it),
you&rsquo;ve probably heard of elliptic curves.
It is important to know that elliptic curves are not only used in cryptography,
but also in many other fields of mathematics,
such as number theory, algebraic geometry, and topology.</p>
<p>My main argument is that elliptic curves are not that hard to understand.
Additionally, since encryption is ubiquitous in our daily lives,
<strong>understanding them is important to be a well-informed citizen</strong>.
I&rsquo;ll try to explain the concepts in a simple way,
but I&rsquo;ll assume you have some basic knowledge of algebra and math symbols.
Finally, I&rsquo;ll use the standard math notation,
so that when you read about elliptic curves in other places,
you&rsquo;ll be able to make connections more easily.</p>
<h2 id="what-is-an-elliptic-curve">What is an Elliptic Curve?</h2>
<p><strong>An <a href="https://en.wikipedia.org/wiki/Elliptic_curve"><em>elliptic curve</em></a> is a curve defined by the equation</strong></p>
<p>$$y^2 = x^3 + ax + b$$</p>
<p>where $a$ and $b$ are real numbers.</p>
<p>Here&rsquo;s an example of an elliptic curve,
if you set $a = 0$ and $b = 7$:</p>
<p>$$y^2 = x^3 + 7$$</p>
<p><strong>This is <a href="https://en.bitcoin.it/wiki/Secp256k1"><code>secp256k1</code></a>,
the notorious elliptic curve used in Bitcoin</strong>.</p>
<figure>
    <img loading="lazy" src="ec.png"/> <figcaption>
            secp256k1 curve
        </figcaption>
</figure>

<p>Elliptic curves have some properties that make them interesting.
For example, they are <strong>symmetric with respect to the $x$-axis</strong>.
This means that if $(x, y)$ is a point in the curve,
then $(x, -y)$ is also a point in the curve<sup id="fnref:1"><a href="#fn:1" class="footnote-ref" role="doc-noteref">1</a></sup>.
This is because $(-y)^2 = y^2$.</p>
<h3 id="adding-points-in-an-elliptic-curve">Adding Points in an Elliptic Curve</h3>
<p>If you have two points $P$ and $P^\prime$ in the curve,
then the line that passes through them will intersect the curve in a third point<sup id="fnref:2"><a href="#fn:2" class="footnote-ref" role="doc-noteref">2</a></sup>
$P^{\prime\prime}$:</p>
<figure>
    <img loading="lazy" src="ec_point.png"/> <figcaption>
            Two Points in an Elliptic Curve
        </figcaption>
</figure>

<p>If you reflect $P^{\prime\prime}$ with respect to the $x$-axis,
you&rsquo;ll get a new point:</p>
<figure>
    <img loading="lazy" src="ec_point_add.png"/> <figcaption>
            Adding Two Points in an Elliptic Curve
        </figcaption>
</figure>

<p>This is how you <strong>add two points in an elliptic curve</strong>.
Note that the result of adding two points is <strong>also a point in the curve</strong>.
This property is called <em>closure</em>.
For any two points $P$ and $P^\prime$ in the curve,
$P + P^\prime$ is also a point in the curve.</p>
<p>There are <strong>two cases where the line doesn&rsquo;t intersect the curve in a third point</strong>.
The first one is when $P = P^\prime$.</p>
<figure>
    <img loading="lazy" src="ec_point_tangent.png"/> <figcaption>
            Adding a Point to Itself in an Elliptic Curve
        </figcaption>
</figure>

<p>Then we have a tangent line.
In this case we take derivatives on both sides:</p>
<p>$$\begin{aligned}
y^2 &amp;= x^3 + ax + b \\
2y \frac{dy}{dx} &amp;= 3x^2 + a \\
\frac{dy}{dx} &amp;= \frac{3x^2 + a}{2y}
\end{aligned}$$</p>
<p>Hence, $2*P = (x, y)$ where $x = \left( \frac{3x^2 + a}{2y} \right) - 2x$,
and $y = \left( \frac{3x^2 + a}{2y} \right) (x - x) - y$.</p>
<p>The other is when $P^\prime$ is the reflection of $P$ with respect to the $x$-axis.</p>
<figure>
    <img loading="lazy" src="ec_point_vertical.png"/> <figcaption>
            Adding a Point to Its Reflection in an Elliptic Curve
        </figcaption>
</figure>

<p>Then we have a vertical line.
In this case we define $P + P^\prime = \mathcal{O}$,
where $\mathcal{O}$ is the <strong>point at infinity</strong>.</p>
<h3 id="point-addition-properties">Point Addition Properties</h3>
<p>Point addition satisfies some properties:</p>
<ul>
<li><strong>Identity</strong>: $P + \mathcal{O} = \mathcal{O} + P = P$</li>
<li><strong>Commutativity</strong>: $P + P^\prime = P^\prime + P$</li>
<li><strong>Associativity</strong>: $(P + P^\prime) + P^{\prime\prime} = P + (P^\prime + P^{\prime\prime})$</li>
<li><strong>Inverse Element</strong>: $P + (-P) = \mathcal{O}$</li>
<li><strong>Closure</strong>: $P + P^\prime$ is a point in the curve</li>
</ul>
<p>Hey this is very similar to addition of integers!
But using points instead of integers.</p>
<p>In fact, we can define <strong>multiplication</strong> of a point $P$ by an integer $n$ as:</p>
<p>$$\underbrace{P + P + \cdots + P}_{n \text{ times}}$$</p>
<h3 id="abelian-groups">Abelian Groups</h3>
<p>The set of points in an elliptic curve with the point at infinity $\mathcal{O}$
along with a binary operation $+$ that satisfies the properties above is called an
<a href="https://en.wikipedia.org/wiki/Abelian_group"><em>Abelian group</em></a>.
In honor of Niels Henrik Abel, an Abelian group is a <strong>set with a binary operation that
satisfies all the properties above</strong>.</p>
<p>Another example of an Abelian group is the set of integers $\mathbb{Z}$ with addition $+$.
And another one is the set of natural numbers $\mathbb{N}$ with multiplication $\times$.</p>
<h2 id="fields">Fields</h2>
<p>There&rsquo;s one more concept that we need to learn before we can talk about cryptography.
It&rsquo;s called a finite field.
But before we talk about finite fields,
we need to first define a <strong>field</strong>.
<strong><a href="https://en.wikipedia.org/wiki/Field_(mathematics)">Fields</a> are sets with two binary operations,
called addition $+$ and multiplication $\times$</strong>.
We write</p>
<p>$$F = (F, +, \times)$$</p>
<p>to denote a field,
where $F$ is the set, $+$ is the addition operation,
and $\times$ is the multiplication operation.</p>
<p>Addition and multiplication behave similar to the addition and multiplication of real numbers.
For example, addition is <strong>commutative</strong> and <strong>associative</strong></p>
<p>$$a + b = b + a,$$</p>
<p>and multiplication is <strong>distributive</strong></p>
<p>$$a \times (b + c) = a \times b + a \times c.$$</p>
<p>Also, there are two special elements in the field,
called the <strong>additive identity</strong> $-a$ and the <strong>multiplicative identity</strong> $a^{-1}$,
such that</p>
<p>$$a + (-a) = a,$$</p>
<p>and</p>
<p>$$a \times a^{-1} = a.$$</p>
<p>Note that this allows us to define <strong>subtraction</strong></p>
<p>$$a - b = a + (-b),$$</p>
<p>and <strong>division</strong></p>
<p>$$a \div b = a \times b^{-1}.$$</p>
<h3 id="finite-fields">Finite Fields</h3>
<p>Now we are ready for finite fields.
A <a href="https://en.wikipedia.org/wiki/Finite_field"><em>finite field</em></a>, also called a Galois field (in honor of Ã‰variste Galois),
is a <strong>field with a finite number of elements.
As with any field, a finite field is a set on which the operations of multiplication,
addition, subtraction and division are defined and satisfy the rules above for fields</strong>.</p>
<p>Finite fields is a very rich topic in mathematics,
and there are many ways to construct them.
The easiest way to construct a finite field is to take the <strong>integers modulo a prime number $p$</strong>.
For example $\mathbb{Z}_4$ is a finite field with 4 elements:</p>
<p>$$\mathbb{Z}_4 = \lbrace 0, 1, 2, 3 \rbrace.$$</p>
<p>In general, $\mathbb{Z}_n$ is a finite field with $n$ elements:</p>
<p>$$\mathbb{Z}_n = \lbrace 0, 1, 2, \ldots, n - 1 \rbrace.$$</p>
<p><strong>The number of elements in a finite field is called the <em>order</em> of the field</strong>.
The order of a finite field is <strong>always a prime number $p$</strong>.
The $\mathbb{Z}_4$ example above is a finite field of order 2.
To see that notice that $4$ is a composite number,</p>
<p>$$4 = 2 \times 2.$$</p>
<p>And we can write $\mathbb{Z}_4$ as</p>
<p>$$\mathbb{Z}_4 = 2 \times \mathbb{Z}_2.$$</p>
<p>This means that every element in $a \in \mathbb{Z}_4$ can be written as</p>
<p>$$a = 2 \times b,$$</p>
<p>where $b$ is an element in $\mathbb{Z}_2$.</p>
<p>Hence, not every element of $\mathbb{Z}_4$ is unique, and they are equivalent to the elements in $\mathbb{Z}_2$.</p>
<p>In general if $n$ is a composite number,
then $\mathbb{Z}_n$ is not a finite field.
However, if $n = r \times s$ where $r$ and $s$ are prime numbers,
and $r &lt; s$,
then $\mathbb{Z}_n$ is a finite field of order $r$.</p>
<h4 id="operations-in-finite-fields">Operations in Finite Fields</h4>
<p><strong>Addition</strong> in finite fields is defined as the remainder of the sum of two elements modulo the order of the
field.</p>
<p>For example, in $\mathbb{Z}_3$,</p>
<p>$$1 + 2 = 3 \mod 3 = 0.$$</p>
<p>We can also define subtraction in finite fields as the remainder of the difference of two elements modulo the order of the field.</p>
<p>For example, in $\mathbb{Z}_3$,</p>
<p>$$1 - 2 = -1 \mod 3 = 2.$$</p>
<p>Multiplication in finite fields can be written as multiple additions.
For example, in $\mathbb{Z}_3$,</p>
<p>$$2 \times 2 = 2 + 2 = 4 \mod 3 = 1.$$</p>
<p>Exponentiation in finite fields can be written as multiple multiplications.
For example, in $\mathbb{Z}_3$,</p>
<p>$$2^2 = 2 \times 2 = 4 \mod 3 = 1.$$</p>
<p>This is very trivial for any finite field.
However, for division we are pretty much screwed.
It is really hard to find the multiplicative inverse of an element in a finite field.
For example, suppose that we have numbers $a,b$ in a very large finite field $\mathbb{Z}_n$,
such that</p>
<p>$$c = a \times b \mod n.$$</p>
<p>Then we can write division as</p>
<p>$$a = c \div b = c \times b^{-1} \mod n.$$</p>
<p>Now we need to find $b^{-1}$.
This is called the <a href="https://en.wikipedia.org/wiki/Discrete_logarithm"><strong><em>discrete logarithm problem</em></strong></a>.
Because we need to find the exponent $b^{-1}$ such that</p>
<p>$$b^{-1} = \log_b c \mod n.$$</p>
<p>Since this number is a discrete number and not a real number,
that&rsquo;s why it&rsquo;s called the discrete logarithm problem.</p>
<p>Good luck my friend, no efficient method is known for computing them in general.
You can try brute force, but that&rsquo;s not efficient.</p>
<h5 id="why-the-discrete-logarithm-problem-is-hard-as-fuck">Why the Discrete Logarithm Problem is Hard as Fuck</h5>
<p>To get a feeling why the discrete logarithm problem is difficult,
let&rsquo;s add one more concept to our bag of knowledge.
Every finite field has <em><strong>generators</strong></em>,
also known as <em><strong>primitive roots</strong></em>,
which is also a member of the group,
such that applying multiplication to this one single element
makes possible to generate the whole finite field.</p>
<p>Let&rsquo;s illustrate this with an example.
Below we have a table of all the results of the following operation</p>
<p>$$b^x \mod 7$$</p>
<p>for every possible value of $x$.
As you&rsquo;ve guessed right this is the $\mathbb{Z}_7$ finite field.</p>
<table>
<thead>
<tr>
<th style="text-align:center">$b$</th>
<th style="text-align:center">$b^1 \mod 7$</th>
<th style="text-align:center">$b^2 \mod 7$</th>
<th style="text-align:center">$b^3 \mod 7$</th>
<th style="text-align:center">$b^4 \mod 7$</th>
<th style="text-align:center">$b^5 \mod 7$</th>
<th style="text-align:center">$b^6 \mod 7$</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">$1$</td>
<td style="text-align:center">$1$</td>
<td style="text-align:center">$1$</td>
<td style="text-align:center">$1$</td>
<td style="text-align:center">$1$</td>
<td style="text-align:center">$1$</td>
<td style="text-align:center">$1$</td>
</tr>
<tr>
<td style="text-align:center">$2$</td>
<td style="text-align:center">$2$</td>
<td style="text-align:center">$4$</td>
<td style="text-align:center">$1$</td>
<td style="text-align:center">$2$</td>
<td style="text-align:center">$4$</td>
<td style="text-align:center">$1$</td>
</tr>
<tr>
<td style="text-align:center">$3$</td>
<td style="text-align:center">$3$</td>
<td style="text-align:center">$2$</td>
<td style="text-align:center">$6$</td>
<td style="text-align:center">$4$</td>
<td style="text-align:center">$5$</td>
<td style="text-align:center">$1$</td>
</tr>
<tr>
<td style="text-align:center">$4$</td>
<td style="text-align:center">$4$</td>
<td style="text-align:center">$2$</td>
<td style="text-align:center">$1$</td>
<td style="text-align:center">$4$</td>
<td style="text-align:center">$2$</td>
<td style="text-align:center">$1$</td>
</tr>
<tr>
<td style="text-align:center">$5$</td>
<td style="text-align:center">$5$</td>
<td style="text-align:center">$4$</td>
<td style="text-align:center">$6$</td>
<td style="text-align:center">$2$</td>
<td style="text-align:center">$3$</td>
<td style="text-align:center">$1$</td>
</tr>
<tr>
<td style="text-align:center">$6$</td>
<td style="text-align:center">$6$</td>
<td style="text-align:center">$1$</td>
<td style="text-align:center">$6$</td>
<td style="text-align:center">$1$</td>
<td style="text-align:center">$1$</td>
<td style="text-align:center">$1$</td>
</tr>
</tbody>
</table>
<p>You see that something interesting is happening here.
For specific values of $b$, such as $b = 3$, and $b = 5$, we are able to <strong>generate the whole finite field</strong>.
Hence, say that $3$ and $5$ are <em><strong>generators</strong></em> or <em><strong>primitive roots</strong></em> of $\mathbb{Z}_7$.</p>
<p>Now suppose I ask you to find $x$ in the following equation</p>
<p>$$3^x \mod p = 11$$</p>
<p>where $p$ is a very large prime number.
Then you don&rsquo;t have any other option than brute forcing it.
<strong>You&rsquo;ll need to try each exponent $x$ until you find the one that satisfies the equation</strong>.</p>
<p>Notice that this operation is very asymmetric.
It is very easy to compute $3^x \mod p$ for any $x$,
but it is very hard to find $x$ given $3^x \mod p$.</p>
<h2 id="bringing-it-all-together">Bringing it All Together</h2>
<p>Now we are ready to talk about elliptic curve cryptography.
<strong>Elliptic curve cryptography is a public-key encryption technique based on elliptic curves</strong>.
It is used to create public and private keys for asymmetric cryptography.</p>
<p>Your <strong>private key is a random number $k$</strong>.
Your <strong>public key is the point $kG$ in the elliptic curve</strong>,
where $G$ is a point and a generator of the elliptic curve.
We know that $kG$ is a point in the elliptic curve,
because elliptic curves are Abelian groups,
having the closure property,
then</p>
<p>$$kG = \underbrace{G + G + \cdots + G}_{k \text{ times}}$$</p>
<p>is also a point in the elliptic curve.</p>
<p>Now here comes the grand finale.
Since elliptic curves are finite fields,
then we can use the discrete logarithm problem to our advantage.
<strong>It is very easy to compute $kG$ given $k$ and $G$</strong>.
But it is <strong>hard as fuck to find $k$ given $kG$ and $G$</strong>.</p>
<h2 id="the-secp256k1-elliptic-curve">The <code>secp256k1</code> Elliptic Curve</h2>
<p>Let&rsquo;s talk about some facts<sup id="fnref:3"><a href="#fn:3" class="footnote-ref" role="doc-noteref">3</a></sup> about our muse <code>secp256k1</code> elliptic curve:</p>
<ul>
<li><strong>Equation</strong>: $y^2 = x^3 + 7$</li>
<li><strong>$\mathbb{F}_p$ where $p$</strong>: $2^{256} - 2^{32} - 2^9 - 2^8 - 2^7 - 2^6 - 2^4 - 1$ (yes, it is a prime number)</li>
<li><strong>Order $n$</strong>: this is the number of possible points in the curve<sup id="fnref:4"><a href="#fn:4" class="footnote-ref" role="doc-noteref">4</a></sup>, 0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141<sup id="fnref:5"><a href="#fn:5" class="footnote-ref" role="doc-noteref">5</a></sup></li>
<li><strong>Generator Point $G$</strong>: (0x79BE667EF9DCBBAC55A06295CE870B07029BFCDB2DCE28D959F2815B16F81798, 0x483ADA7726A3C4655DA4FBFC0E1108A8FD17B448A68554199C47D08FFB10D4B8)<sup id="fnref1:5"><a href="#fn:5" class="footnote-ref" role="doc-noteref">5</a></sup></li>
</ul>
<h2 id="license">License</h2>
<p>This post is licensed under <a href="http://creativecommons.org/licenses/by-nc-sa/4.0/">Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International</a>.</p>
<p><a href="http://creativecommons.org/licenses/by-nc-sa/4.0/"><img loading="lazy" src="https://licensebuttons.net/l/by-nc-sa/4.0/88x31.png" alt="CC BY-NC-SA 4.0"  />
</a></p>
<div class="footnotes" role="doc-endnotes">
<hr>
<ol>
<li id="fn:1">
<p>This is also why transaction malleability was a problem before Segwit in Bitcoin.&#160;<a href="#fnref:1" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:2">
<p>If the line is vertical or tangent to the curve,
then it intersects the curve in a point at infinity.&#160;<a href="#fnref:2" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:3">
<p>These are standard and defined in the <a href="https://www.secg.org/">Standards for Efficient Cryptography Group</a>
in their <a href="https://www.secg.org/sec2-v2.pdf">SEC 2 specification</a>.&#160;<a href="#fnref:3" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:4">
<p>To find the order of an elliptic curve, you can use <a href="https://en.wikipedia.org/wiki/Schoof%27s_algorithm#The_algorithm">Schoof&rsquo;s algorithm</a>.&#160;<a href="#fnref:4" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:5">
<p>It is a fucking big number, so I am putting the values in hexadecimal representation.&#160;<a href="#fnref:5" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a>&#160;<a href="#fnref1:5" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
</ol>
</div>
]]></content:encoded>
    </item>
    
    <item>
      <title>Taproot Basics</title>
      <link>https://realeinherjar.github.io/2023-09-08-taproot/</link>
      <pubDate>Sat, 02 Sep 2023 12:10:10 -0300</pubDate>
      
      <guid>https://realeinherjar.github.io/2023-09-08-taproot/</guid>
      <description>Warning: This post has KaTeX enabled, so if you want to view the rendered math formulas, you&amp;rsquo;ll have to unfortunately enable JavaScript.
While attending the 2023 edition of TabConf, hosted in Atlanta, USA, from Sep 6th to Sep 9th, I also attended Base58&amp;rsquo;s intensive course on Taproot and Schnorr signatures. The course took place in the two days before the conference, on Sep 4th and Sep 5th.
Here is a very broad overview based on my notes, a bunch of readings and some of my own research.</description>
      <content:encoded><![CDATA[<blockquote>
<p>Warning: This post has <a href="https://katex.org/">KaTeX</a> enabled,
so if you want to view the rendered math formulas,
you&rsquo;ll have to unfortunately enable JavaScript.</p>
</blockquote>
<p>While attending the 2023 edition of <a href="https://tabconf.com">TabConf</a>,
hosted in Atlanta, USA, from Sep 6th to Sep 9th,
I also attended <a href="https://base58.school">Base58</a>&rsquo;s
intensive course on <a href="https://bitcoinops.org/en/topics/taproot/">Taproot</a>
and <a href="https://en.wikipedia.org/wiki/Schnorr_signature">Schnorr signatures</a>.
The course took place in the two days before the conference,
on Sep 4th and Sep 5th.</p>
<p>Here is a very broad overview based on my notes,
a bunch of readings and some of my own research.
I am omitting a lot of details here.
If you want to learn more,
whenever you see a footnote,
or a like to a Bitcoin Imporvement Proposal (BIP),
go check it out.</p>
<h2 id="taproot-design-goals">Taproot Design Goals</h2>
<p>Taproot was activated as a soft fork in <strong>November 2021</strong>.</p>
<p>The <strong>design goals of Taproot</strong> are:</p>
<ul>
<li><strong>Increase privacy</strong>: hide the spending conditions
and also hide the fact that you are using a multisig.</li>
<li><strong>Reduce the amount of data on-chain</strong>: you only need to commit
to the root of the tree, and not the leaves.</li>
<li><strong>Use Schnorr</strong>: Schnorr signatures are more efficient
and allow for signature aggregation.</li>
</ul>
<h2 id="schnorr-signatures">Schnorr Signatures</h2>
<p><a href="https://en.wikipedia.org/wiki/Schnorr_signature"><strong>Schnorr signatures</strong></a>
are a type of digital signature scheme
that provides security and efficiency advantages
over traditional ECDSA (Elliptic Curve Digital Signature Algorithm) signatures.
They were proposed by the mathematician and cryptographer <a href="https://en.wikipedia.org/wiki/Claus_P._Schnorr">Claus-Peter Schnorr</a>.
Schnorr signatures improve privacy, scalability, and security.
Due to the commutativity property,
Schnorr signatures can be aggregated,
allowing multiple signatures to be combined into a single signature.
This improves privacy by <strong>obscuring the number of participants
in a multi-signature transaction</strong>.
They are detailed in <a href="https://github.com/bitcoin/bips/blob/master/bip-0340.mediawiki">BIP 340</a>.
The nice thing about Schnorr signatures is that
the <strong>sum of private keys is equal to the private key of the sum of public keys</strong>.
This is what I call <strong>&ldquo;commutativity property&rdquo;</strong>,
and allows for <strong>signature aggregation</strong><sup id="fnref:1"><a href="#fn:1" class="footnote-ref" role="doc-noteref">1</a></sup>.</p>
<p>Here&rsquo;s in a more formal way:</p>
<p>$$ P = p \cdot G $$</p>
<p>where $G$ is the generator point<sup id="fnref:2"><a href="#fn:2" class="footnote-ref" role="doc-noteref">2</a></sup>
and $p$ is the sum of $n$ private keys,</p>
<p>$$ p = \sum_{i=1}^{n} p_i $$</p>
<p>and $P$ is the sum of $n$ public keys<sup id="fnref:3"><a href="#fn:3" class="footnote-ref" role="doc-noteref">3</a></sup>:</p>
<p>$$ P = \sum_{i=1}^{n} p_i \cdot G $$</p>
<h2 id="validation-of-taproot-scripts">Validation of Taproot Scripts</h2>
<p>The validation of Taproot Scripts as detailed in
<a href="https://github.com/bitcoin/bips/blob/master/bip-0342.mediawiki">BIP 342</a>,
that deals with <code>OP_CHECKSIG</code> and <code>OP_CHECKSIGADD</code> opcodes<sup id="fnref:4"><a href="#fn:4" class="footnote-ref" role="doc-noteref">4</a></sup>.
This does Schnorr signature aggregation during the Script execution.</p>
<p>A 2-of-3 multisig with Schnorr signatures spending Script with <code>OP_CHECKSIG</code>
and <code>OP_CHECKSIGADD</code> would be:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">pubkey1 OP_CHECKSIG pubkey2 OP_CHECKSIGADD pubkey3 OP_CHECKSIGADD OP_2 OP_EQUAL
</span></span></code></pre></div><p>This would reveal everyone&rsquo;s public keys on-chain,
and also the fact that it is a multisig, with all of the conditions.
Additionally, it would be expensive to spend,
due to the number of bytes required to commit to the Script on-chain.</p>
<p>There are more elegant ways to do this with Taproot Spending Rules
and Merkle Trees, which we&rsquo;ll see next.</p>
<h2 id="taproot-merkle-tree">Taproot Merkle Tree</h2>
<p>Taproot is a series of spending conditions that are defined
in a binary tree.
Instead of a bunch of conditions that are visible using a Script,
we have a binary tree with merkle roots.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">            Root
</span></span><span class="line"><span class="cl">             |
</span></span><span class="line"><span class="cl">             |
</span></span><span class="line"><span class="cl">         /       \
</span></span><span class="line"><span class="cl">        /         \
</span></span><span class="line"><span class="cl">       /           \
</span></span><span class="line"><span class="cl">    Cond 1       Cond 2
</span></span><span class="line"><span class="cl">                  /  \
</span></span><span class="line"><span class="cl">                 /    \
</span></span><span class="line"><span class="cl">             Cond 3   Cond 4
</span></span></code></pre></div><p>The root is a hash, and is implicity commited to on-chain.
The conditions are not visible on-chain,
because you just commit the hash of the root on-chain.</p>
<p>The way you build the root is by hashing all the intermediate states<sup id="fnref:5"><a href="#fn:5" class="footnote-ref" role="doc-noteref">5</a></sup>,
is by hashing all the leaves and branches below the root node.
This is done using a $\operatorname{hash}(l \mid\mid r)$ function,
where $l$ is the left node and $r$ is the right node<sup id="fnref:6"><a href="#fn:6" class="footnote-ref" role="doc-noteref">6</a></sup>.
The locking script will be:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">script: &lt;version-byte&gt; &lt;data&gt;
</span></span></code></pre></div><p>where:</p>
<ul>
<li><code>&lt;version-byte&gt;</code> is the version byte.
This is the version number of our &ldquo;segwit script&rdquo;.</li>
<li><code>&lt;data&gt;</code> is <code>P_x</code>, the x-coordinate of the (tweaked) public key<sup id="fnref:7"><a href="#fn:7" class="footnote-ref" role="doc-noteref">7</a></sup>.</li>
</ul>
<h2 id="taproot-spending-rules">Taproot Spending Rules</h2>
<p>Taproot spending rules are detailed in <a href="https://github.com/bitcoin/bips/blob/master/bip-0341.mediawiki">BIP 341</a>.
The way Taproot works is that you have a locking script
where all the spending conditions are hidden.
This is just the hash of the root of the binary tree below.
The way you construct the script is by using a merkle tree,
and hashing all the intermediate states,
i.e. all the leaves and branches below the root node.
The hash is done by concatenating the string representation
of the two things you want to hash and applying SHA256<sup id="fnref1:6"><a href="#fn:6" class="footnote-ref" role="doc-noteref">6</a></sup>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">hash = SHA256(left || right)
</span></span></code></pre></div><p>In the following example,
you would hash <code>Cond 3</code> with <code>Cond 4</code>,
then hash the result with <code>Cond 1</code>.
This is the root commitment,
i.e. the root node,
and the thing you publish on-chain.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">       Root commitment
</span></span><span class="line"><span class="cl">       (locking script)
</span></span><span class="line"><span class="cl">             |
</span></span><span class="line"><span class="cl">             |
</span></span><span class="line"><span class="cl">         /       \
</span></span><span class="line"><span class="cl">        /         \
</span></span><span class="line"><span class="cl">       /           \
</span></span><span class="line"><span class="cl">    Cond 1       Cond 2
</span></span><span class="line"><span class="cl">    (leaf)      (branch)
</span></span><span class="line"><span class="cl">                  /  \
</span></span><span class="line"><span class="cl">                 /    \
</span></span><span class="line"><span class="cl">             Cond 3   Cond 4
</span></span><span class="line"><span class="cl">             (leaf)   (leaf)
</span></span></code></pre></div><p>We have 3 leaves here: <code>Cond 1</code>, <code>Cond 3</code> and <code>Cond 4</code>,
and 1 branch: <code>Cond 2</code>.</p>
<p>The way the spening rules work is that you have to provide a proof-of-inclusion,
which depends on the leaf you want to spend.
So if you want to spend <code>Cond 3</code>,
you need to provide the hash of <code>Cond 4</code> and <code>Cond 1</code>.
Whereas, if you want to spend <code>Cond 1</code>,
you just need to provide the hash of <code>Cond 1</code> and the hash of the branch <code>Cond 2</code>.
Hence, spending conditions that are higher in the tree are cheaper to spend,
because you need to commit less data on-chain.
That is why we structure the tree as most probable to be used on top.</p>
<h2 id="musig2">MuSig2</h2>
<p><a href="https://eprint.iacr.org/2020/1261">MuSig2</a>,
detailed in <a href="https://github.com/bitcoin/bips/blob/master/bip-0327.mediawiki">BIP 327</a>,
is similar to <code>OP_CHECKSIGADD</code>.
It allows for signature aggregation in the locking script,
and also in the unlocking script.
Hence, you can have any multisig with Schnorr signatures,
without revealing anything related to the number of participants on-chain,
multisig conditions, etc.
However,
you now need to put all the possible combinations of the pubkeys in the Script.
Mind you that this is not a problem,
because the resulting aggregate signature
will not reveal the underlying individual signatures.</p>
<p>Here&rsquo;s a MuSig2 example 2-of-3 threshold,
you&rsquo;ll need 3 spending conditions:</p>
<p>$$P_1 + P_2$$
$$P_1 + P_3$$
$$P_2 + P_3$$</p>
<p>where $P_n$ is the public key of the $n$-th participant.</p>
<p>Generally, for $n$ pubkeys with a threshold of $t$,
you need a list of size $\binom{n}{t}$ for all possible combinations.</p>
<p>Continuing the example,
for every two pairs of pubkeys,
aggregate them using elliptic curve cryptography modular algebra,
tweak them (if necessary)<sup id="fnref1:7"><a href="#fn:7" class="footnote-ref" role="doc-noteref">7</a></sup>,
and create a script:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">(P_1 + P_2) OP_CHECKSIG
</span></span></code></pre></div><p>Next, you consruct your Taproot tree listing all the possible spending conditions.
(Remember to prioritize by the most plausible spending conditions on top).
Calculate the root commitment by hashing all the intermediate states,
which are the spending conditions on each leaf or branch,
from bottom to top.
Pick an internal key
and if necessary, tweak<sup id="fnref2:7"><a href="#fn:7" class="footnote-ref" role="doc-noteref">7</a></sup> it to derive an external key.
Finally, lock up some bitcoin to the root commitment.
That&rsquo;s it!
You have a Taproot tree with MuSig2 that is compact on-chain,
and also private.
Additionally, you can add more creative spending conditions using Script
to the leaves of the tree.</p>
<p>To spend it, in your unlocking script,
you&rsquo;ll need to provide a proof-of-inclusion
of the spending condition you want to spend,
and the aggregated signature to unlock that spending condition.</p>
<h2 id="license">License</h2>
<p>This post is licensed under
<a href="http://creativecommons.org/licenses/by-nc-sa/4.0/">Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International</a>.</p>
<p><a href="http://creativecommons.org/licenses/by-nc-sa/4.0/"><img loading="lazy" src="https://licensebuttons.net/l/by-nc-sa/4.0/88x31.png" alt="CC BY-NC-SA 4.0"  />
</a></p>
<div class="footnotes" role="doc-endnotes">
<hr>
<ol>
<li id="fn:1">
<p>Signature aggregations depends on a series of rounds of communication,
proposed in <a href="https://eprint.iacr.org/2018/068.pdf"><strong>MuSig</strong></a>
(3 rounds of communication),
and superseeded by
<a href="https://eprint.iacr.org/2020/1261"><strong>MuSig2</strong></a>
(which needs 2 rounds of communication, instead of 3)
and detailed in <a href="https://github.com/bitcoin/bips/blob/master/bip-0327.mediawiki">BIP 327</a>.
There are tweaks to the internal key,
and also nonce generation and aggregation.
I won&rsquo;t go in to the scope of BIP 327 here,
but I recommend you to read it if you want to know more.&#160;<a href="#fnref:1" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:2">
<p>If you don&rsquo;t know what a generator point is,
check the <a href="https://en.wikipedia.org/wiki/Elliptic-curve_cryptography#Domain_parameters">Wikipedia article on Elliptic Curve Cryptography</a>.&#160;<a href="#fnref:2" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:3">
<p>Don&rsquo;t forget to $\mod{n}$.&#160;<a href="#fnref:3" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:4">
<p>See the <a href="https://en.bitcoin.it/wiki/Script">Script page at Bitcoin Wiki</a>.&#160;<a href="#fnref:4" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:5">
<p>Additionally you need to provide a tag,
which are detailed in <a href="https://github.com/bitcoin/bips/blob/master/bip-0340.mediawiki">BIP 340</a>.&#160;<a href="#fnref:5" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:6">
<p>There are some rules to remove ambiguity
on which one will be the <code>left</code> and <code>right</code> node in the hash function.&#160;<a href="#fnref:6" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a>&#160;<a href="#fnref1:6" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:7">
<p>In Taproot Spending rules,
you can have an internal key and an external key.
The internal key is tweaked with &ldquo;tag&rdquo; hashes to derive the external key.
Check <a href="https://github.com/bitcoin/bips/blob/master/bip-0341.mediawiki">BIP 341</a>.&#160;<a href="#fnref:7" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a>&#160;<a href="#fnref1:7" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a>&#160;<a href="#fnref2:7" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
</ol>
</div>
]]></content:encoded>
    </item>
    
    <item>
      <title>On Censorship</title>
      <link>https://realeinherjar.github.io/2023-08-19-censorship/</link>
      <pubDate>Sat, 19 Aug 2023 18:07:18 +0000</pubDate>
      
      <guid>https://realeinherjar.github.io/2023-08-19-censorship/</guid>
      <description>In Brazil, there&amp;rsquo;s a new law that is being proposed that will allow the government to censor social media posts. The law is called PL 2630/2020 and it&amp;rsquo;s being called the &amp;ldquo;Fake News Law&amp;rdquo;. It&amp;rsquo;s a very dangerous law that will allow the government to censor any post that it deems &amp;ldquo;fake news&amp;rdquo;. The problem is that the definition of &amp;ldquo;fake news&amp;rdquo; is very broad and can be used to censor any post that the government doesn&amp;rsquo;t like.</description>
      <content:encoded><![CDATA[<p>In Brazil, there&rsquo;s a new law that is being proposed that will allow the government to censor social media posts.
The law is called <a href="https://www.camara.leg.br/propostas-legislativas/2256735">PL 2630/2020</a> and it&rsquo;s being called the &ldquo;Fake News Law&rdquo;.
It&rsquo;s a very dangerous law that will allow the government to censor any post that it deems &ldquo;fake news&rdquo;.
The problem is that the definition of &ldquo;fake news&rdquo; is very broad and can be used to censor any post that the government doesn&rsquo;t like.</p>
<p>It is actually already being used to do exactly that.
On <a href="https://www1.folha.uol.com.br/poder/2023/05/google-retira-do-ar-link-com-informacoes-contra-o-pl-das-fake-news.shtml">May 2nd, 2023, the Ministry of Justice ordered Google to remove a blog post from its main page</a>.
This blog post was Google&rsquo;s opinion on the law and why Google think it is bad.
You can find it <a href="https://blog.google/intl/pt-br/novidades/iniciativas/PL2630/">here</a>.</p>
<p>Then, on <a href="https://www.infomoney.com.br/politica/alexandre-de-moraes-abre-inquerito-e-manda-investigar-diretores-do-google-e-do-telegram/">May 12th, 2023, the Supreme Minister Alexandre de Moraes opened a criminal investigation of the Google (and Telegram) directors,
on the grounds of &ldquo;abusive campaign against the PL 2630/2020&rdquo;</a>.
I don&rsquo;t think that constitutes a crime, but the Supreme Minister does.
For my point of view, it&rsquo;s just an opinion, and it&rsquo;s not a crime to have an opinion.
Despite not liking Google, I think that it is a valid participant in the discussion of the law.
Such discussions should happen in a healthy democracy.</p>
<p>Of course, Google used its power to promote its opinion, but <em>again</em> that&rsquo;s not a crime.
Let&rsquo;s do a thought experiment, let&rsquo;s go back to 1850s USA.
Dred Scott v. Sandford (1857), according to <a href="https://en.wikipedia.org/wiki/Dred_Scott_v._Sandford">Wikipedia</a>,
was a &ldquo;landmark decision of the United States Supreme Court that held the U.S. Constitution did not extend American citizenship to people of black African descent,
and thus they could not enjoy the rights and privileges the Constitution conferred upon American citizens&rdquo;.
That&rsquo;s pretty bad decision, right?
Anyone in their right mind today would agree that violates human rights.
Now, imagine that one of the most powerful companies at that time,
<a href="https://en.wikipedia.org/wiki/Pacific_Mail_Steamship_Company">Pacific Main Steamship Company</a>,
would use its power to promote the abolitionist movement.
Specifically, it would give a pamphlet to every passenger that boarded its ships with the opinion that the American citizenship should be extended to people of &ldquo;black African descent&rdquo;.
What would happen to the company?
Would it be a crime to promote the abolitionist movement?
Would the Supreme Court open a criminal investigation against the company and its directors?
Think about this for a moment&hellip;</p>
<p>The problem with censorship is that it&rsquo;s very easy to abuse.
I honestly don&rsquo;t care about Google, or the PL 2630/2020.
I know that the internet is decentralized, and content will always find its way and be available somewhere.
There&rsquo;s no way to stop it.
But, I am gravely concerned with the precedents that the Brazilian government and Brazilian Supreme Court are setting when they censor opinions that they don&rsquo;t like.</p>
<h2 id="license">License</h2>
<p>This post is licensed under
<a href="http://creativecommons.org/licenses/by-nc-sa/4.0/">Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International</a>.</p>
<p><a href="http://creativecommons.org/licenses/by-nc-sa/4.0/"><img loading="lazy" src="https://licensebuttons.net/l/by-nc-sa/4.0/88x31.png" alt="CC BY-NC-SA 4.0"  />
</a></p>
]]></content:encoded>
    </item>
    
    <item>
      <title>About</title>
      <link>https://realeinherjar.github.io/about/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>https://realeinherjar.github.io/about/</guid>
      <description>This is a nym. I&amp;rsquo;m a recovering academic in my mid-30s. I hold a PhD and was a faculty member in a computer science department for 5 years. My background is in computational statistics and machine learning. I&amp;rsquo;ve supervised a couple of PhD students, and taught undergraduate and graduate courses in machine learning, deep learning, statistics, data science, and programming.
I am fluent in Rust, Python, and C/C++. Due to my data science background, I also know R, SQL, and Julia.</description>
      <content:encoded><![CDATA[<p>This is a nym.
I&rsquo;m a recovering academic in my mid-30s.
I hold a PhD and was a faculty member in a computer science department for 5 years.
My background is in computational statistics and machine learning.
I&rsquo;ve supervised a couple of PhD students,
and taught undergraduate and graduate courses in machine learning,
deep learning, statistics, data science, and programming.</p>
<p>I am fluent in Rust, Python, and C/C++.
Due to my data science background, I also know R, SQL, and Julia.
I am comfortable in navigating almost any codebase,
disrespecting the programming language,
and also in learning new languages and frameworks.
My workflow, both personal and professional,
is heavily based on Git and GitHub:
PRs, issues, code reviews, CI/CD, project management, releases, etc.
I have solid experience with Docker, Linux and Nix environments, and cloud computing.
As a computational scientist, I am familiar with cryptography,
and I have advanced math skills.</p>
<p>During the day,
I work full-time as a senior scientific software engineer at a software company.
I co-lead a team of around 20 developers.
My role is to review PRs, develop documentation,
triage issues, and mentor junior developers.
I also take on strategic development tasks planning,
such as new features and releases.</p>
<p>I have experience in leading teams and projects,
interfacing with clients, and top management.
As volunteer work,
I have been a mentor for the Google Summer of Code program,
and board member of a non-profit open-source organization that has
NumFOCUS as a fiscal sponsor.
In fact, I was the NumFOCUS financial liaison for that organization.</p>
<p><em>Everything</em> shifted when I encountered Bitcoin.
I had arrived seeking a revolution,
and I was truly captivated by the technology and protocol behind it.</p>
<p>In my free time, I follow the technical developments of Bitcoin,
and also contribute to the ecosystem.
I have a deep understanding of the Bitcoin protocol,
lightning network, and the ecosystem in general.
I also have a good understanding of the economics and game theory behind Bitcoin.
I have knowledge about the codebases of open-source Bitcoin projects,
mainly in Rust and C/C++.</p>
<p>Check my portfolio at <a href="https://github.com/realeinherjar">GitHub</a> for some of my projects.
If you want a full CV, please contact me.</p>
]]></content:encoded>
    </item>
    
    
  </channel>
</rss>
